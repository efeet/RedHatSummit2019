- name: Create function app with Ansible in Docker container
  hosts: localhost
  connection: local
  vars_files:
    - ./vars-myvars.yml
  roles:
    - { role: azure.azure_preview_modules }

  tasks:
    - name: Create a linux app service plan
      azure_rm_appserviceplan:
        resource_group: "{{ resource_group }}"
        name: "{{ function_app_name }}plan"
        sku: S1
        is_linux: true
        number_of_workers: 1

    - name: create storage account for function apps
      azure_rm_storageaccount:
        resource_group: '{{ resource_group }}'
        name: "{{ function_app_name }}st"
        account_type: Standard_LRS

    - name: Create container based function app
      azure_rm_functionapp:
        resource_group: "{{ resource_group }}"
        name: "{{ function_app_name }}"
        storage_account: "{{ function_app_name }}st"
        plan:
          resource_group: "{{ resource_group }}"
          name: "{{ function_app_name }}plan"
        container_settings:
          name: httpd
        app_settings:
          FUNCTIONS_EXTENSION_VERSION: "~2"
